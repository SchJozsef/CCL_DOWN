
<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conclusion Downmeter</title>

<!-- Bootstrap CSS -->
https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css
<!-- Chart.js -->
https://cdn.jsdelivr.net/npm/chart.js</script>

<style>
  body { background: #f8f9fa; transition: background 0.3s, color 0.3s; }
  .dark-mode { background: #121212; color: #f8f9fa; }
  .status-ok { color: #28a745; font-weight: bold; font-size: 1.5rem; }
  .status-error { color: #dc3545; font-weight: bold; font-size: 1.5rem; }
  .chart-container { width: 100%; max-width: 700px; margin: 30px auto; }
  .spinner-border { width: 2rem; height: 2rem; }
</style>
</head>
<body class="container py-4">
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>üåê Conclusion Downmeter</h1>
  <button class="btn btn-secondary" onclick="toggleDarkMode()">üåô S√∂t√©t m√≥d</button>
</div>

<div class="card p-4 mb-4 text-center shadow">
  <h4>Figyelt oldal:</h4>
  <p><strong>https://sm.cetin.rs/conclusion/Main</strong></p>
  <div id="status" class="status mb-3">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Ellen≈ërz√©s folyamatban...</p>
  </div>
  <p><strong>Uptime:</strong> <span id="uptime">0%</span></p>
</div>

<div class="chart-container">
  <canvas id="statusChart"></canvas>
</div>

https://actions.google.com/sounds/v1/alarms/beep_short.ogg</audio>

<script>
const url = "https://sm.cetin.rs/conclusion/Main";
let chart;
let checks = 0, success = 0;
const ctx = document.getElementById('statusChart').getContext('2d');
const alertSound = document.getElementById('alertSound');

chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: 'El√©rhet≈ës√©gi √°llapot (%)',
      data: [],
      borderColor: '#28a745',
      backgroundColor: 'rgba(40,167,69,0.1)',
      fill: true,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { min: 0, max: 100, title: { display: true, text: 'El√©rhet≈ës√©g (%)' } }
    }
  }
});

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

async function checkWebsite() {
  checks++;
  try {
    await fetch(url, { method: 'GET', mode: 'no-cors' });
    success++;
    document.getElementById("status").innerHTML = "<span class='status-ok'>Az oldal el√©rhet≈ë ‚úÖ</span>";
    updateChart(100);
  } catch {
    document.getElementById("status").innerHTML = "<span class='status-error'>Hiba ‚ùå</span>";
    updateChart(0);
    alertSound.play();
  }
  updateUptime();
  saveData();
}

function updateChart(value) {
  chart.data.labels.push(new Date().toLocaleTimeString());
  chart.data.datasets[0].data.push(value);
  if (chart.data.labels.length > 30) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }
  chart.update();
}

function updateUptime() {
  const uptimePercent = ((success / checks) * 100).toFixed(1);
  document.getElementById("uptime").textContent = uptimePercent + "%";
}

function saveData() {
  localStorage.setItem('chartData', JSON.stringify(chart.data));
  localStorage.setItem('checks', checks);
  localStorage.setItem('success', success);
}

function loadData() {
  const savedChart = localStorage.getItem('chartData');
  if (savedChart) {
    chart.data = JSON.parse(savedChart);
    chart.update();
  }
  checks = parseInt(localStorage.getItem('checks')) || 0;
  success = parseInt(localStorage.getItem('success')) || 0;
  updateUptime();
}

loadData();
setInterval(checkWebsite, 5000);
checkWebsite();
</script>
</body>
</html>
